<!doctype html>
<html lang="{{ ui['html_lang'] }}">
<head>
    <meta charset="utf-8">
    <title>{{ ui['title'] }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            base: '#0f172a',
                            accent: '#a3e635',
                            soft: '#1e293b'
                        }
                    },
                    fontFamily: {
                        display: ['"Plus Jakarta Sans"', 'ui-sans-serif', 'system-ui']
                    }
                }
            }
        };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="anonymous">

    <script defer
            src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    {% if js_strings['flatpickrLocale'] not in ['default', 'en', ''] %}
    <script defer src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/{{ js_strings['flatpickrLocale'] }}.js"></script>
    {% endif %}
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body class="theme-dark min-h-screen bg-slate-950 text-slate-100 font-display antialiased">
{% set loader_text = ui['loading_overlay'] %}{% include '_loader.html' %}

<div class="relative">
    <div class="mx-auto flex min-h-screen w-full max-w-6xl flex-col gap-10 px-6 py-10 md:px-12">
        <div class="flex flex-col gap-6 md:flex-row md:items-start md:justify-between">
            <header class="flex flex-col gap-2">
                <p class="text-xs uppercase tracking-[0.35em] text-lime-300/80">{{ ui['header_tagline'] }}</p>
                <h1 class="text-3xl font-semibold text-white md:text-4xl">{{ ui['headline'] }}</h1>
                <p class="max-w-3xl text-sm text-slate-300 md:text-base">{{ ui['subheadline'] }}</p>
            </header>
            <div class="flex items-center gap-3 self-start md:self-center">

                <div class="language-picker" data-language-picker>
                    <span class="sr-only">{{ ui['language_select_aria'] }}</span>
                    <button id="language_menu_button" type="button" class="language-picker__button" aria-haspopup="listbox" aria-expanded="false">
                        <span class="language-picker__flag" aria-hidden="true">{{ current_language_option['flag']|safe }}</span>
                        <span class="language-picker__label">{{ current_language_option['label'] }}</span>
                        <svg class="language-picker__chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="m6 9 6 6 6-6" />
                        </svg>
                    </button>

                    <div id="language_menu" class="language-menu hidden" role="listbox" aria-labelledby="language_menu_button">
                        {% for language in languages %}
                            <button type="button" class="language-menu__item {% if language['code'] == current_language %}is-active{% endif %}" data-lang="{{ language['code'] }}" role="option" {% if language['code'] == current_language %}aria-selected="true"{% else %}aria-selected="false"{% endif %}>
                                <span class="language-menu__flag" aria-hidden="true">{{ language['flag']|safe }}</span>
                                <span class="language-menu__text">{{ language['label'] }}</span>
                            </button>
                        {% endfor %}
                    </div>
                </div>
                <button id="theme_toggle" type="button" class="theme-toggle" aria-pressed="true" aria-label="{{ ui['theme_toggle_label'] }}">
                    <span class="sr-only">{{ ui['theme_toggle_label'] }}</span>
                    <svg class="theme-toggle__icon" data-icon="moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79z" />
                    </svg>
                    <svg class="theme-toggle__icon hidden" data-icon="sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <circle cx="12" cy="12" r="4" />
                        <path d="M12 2v2" />
                        <path d="M12 20v2" />
                        <path d="m4.93 4.93 1.41 1.41" />
                        <path d="m17.66 17.66 1.41 1.41" />
                        <path d="M2 12h2" />
                        <path d="M20 12h2" />
                        <path d="m6.34 17.66-1.41 1.41" />
                        <path d="m19.07 4.93-1.41 1.41" />
                    </svg>
                </button>
            </div>
        </div>

        <main class="grid flex-1 gap-10 pb-12 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)]">
            <section class="space-y-6">
                <div class="rounded-3xl border border-white/10 bg-slate-900/60 p-1">
                    <div id="map" class="h-[340px] w-full overflow-hidden rounded-[calc(theme(borderRadius.3xl)-0.25rem)] bg-slate-950 sm:h-[420px]"></div>
                </div>

                <div class="grid gap-4 sm:grid-cols-[minmax(0,0.7fr)_minmax(0,1.3fr)]">
                    <div class="rounded-2xl border border-white/5 bg-slate-900/70 p-4">
                        <p class="text-xs uppercase tracking-wide text-slate-400">{{ ui['coord_coordinates_label'] }}</p>
                        <div class="mt-3 space-y-3 text-sm text-slate-300">
                            <div>
                                <p class="text-xs uppercase tracking-wide text-slate-500">{{ ui['coord_lat_label'] }}</p>
                                <p id="coord_lat" class="mt-1 text-base font-semibold text-slate-100">--</p>
                            </div>
                            <div>
                                <p class="text-xs uppercase tracking-wide text-slate-500">{{ ui['coord_lon_label'] }}</p>
                                <p id="coord_lon" class="mt-1 text-base font-semibold text-slate-100">--</p>
                            </div>
                        </div>
                    </div>
                    <div class="rounded-2xl border border-white/5 bg-slate-900/70 p-4">
                        <p class="text-xs uppercase tracking-wide text-slate-400">{{ ui['coord_region_label'] }}</p>
                        <div id="coord_region" class="mt-3 space-y-4">
                            <div>
                                <p id="coord_region_title" data-default="{{ ui['coord_region_placeholder'] }}" class="text-lg font-semibold text-slate-100">{{ ui['coord_region_placeholder'] }}</p>
                                <p id="coord_region_meta" data-default="{{ ui['coord_region_meta_default'] }}" class="text-sm text-slate-400">{{ ui['coord_region_meta_default'] }}</p>
                            </div>
                            <div class="space-y-1">
                                <p class="text-xs uppercase tracking-wide text-slate-500">{{ ui['region_station_heading'] }}</p>
                                <p id="coord_region_station" data-default="{{ ui['region_station_unknown'] }}" class="text-sm font-medium text-slate-200">{{ ui['region_station_unknown'] }}</p>
                                <p id="coord_region_distance" class="text-xs text-slate-500 hidden"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="coord_error" class="hidden rounded-2xl border border-red-500/50 bg-red-500/10 p-4 text-sm text-red-200">
                    {{ ui['coord_error'] }}
                </div>

                <input id="address_lat" type="hidden">
                <input id="address_lon" type="hidden">
                <input id="address_country" type="hidden" value="">
            </section>

            <section class="flex flex-col gap-6">
                <div class="rounded-3xl border border-white/10 bg-slate-900/60 p-6">
                    <div class="space-y-6">
                        <div>
                            <div class="mb-2 flex items-center justify-between text-sm font-medium text-slate-300">
                                <span>{{ ui['radius_label'] }}</span>
                                <span><span id="radius_value" class="text-lime-300">25</span> km</span>
                            </div>
                            <input id="radius" type="range" class="w-full accent-lime-400" min="1" max="50" value="25">
                            <div class="mt-2 flex justify-between text-xs text-slate-500">
                                <span>{{ ui['radius_min'] }}</span>
                                <span>{{ ui['radius_max'] }}</span>
                            </div>
                        </div>

                        <div class="grid gap-4 sm:grid-cols-2">
                            <label class="flex flex-col gap-2 text-sm font-medium text-slate-300">
                                <span>{{ ui['start_date_label'] }}</span>
                                <input id="start_date" type="text"
                                       class="date-input w-full rounded-xl border border-white/10 bg-slate-950/60 px-3 py-2 text-slate-100 focus:border-lime-400 focus:ring-2 focus:ring-lime-400/60" placeholder="{{ js_strings['datePlaceholder'] }}" autocomplete="off">
                                <span id="start_error" class="hidden text-xs font-normal text-red-300">{{ ui['start_date_error'] }}</span>
                            </label>
                            <label class="flex flex-col gap-2 text-sm font-medium text-slate-300">
                                <span>{{ ui['end_date_label'] }}</span>
                                <input id="end_date" type="text"
                                       class="date-input w-full rounded-xl border border-white/10 bg-slate-950/60 px-3 py-2 text-slate-100 focus:border-lime-400 focus:ring-2 focus:ring-lime-400/60" placeholder="{{ js_strings['datePlaceholder'] }}" autocomplete="off">
                                <span id="end_error"
                                      class="hidden text-xs font-normal text-red-300">{{ ui['end_date_error'] }}</span>
                            </label>
                        </div>

                        <button id="analyze_btn"
                                class="w-full rounded-2xl bg-gradient-to-r from-lime-400 via-emerald-400 to-sky-400 px-6 py-3 text-base font-semibold text-slate-950 transition hover:brightness-110 focus:outline-none focus:ring-4 focus:ring-lime-300/40">
                            {{ ui['analyze_button'] }}
                        </button>
                    </div>
                </div>

                <div id="result" class="flex-1 rounded-3xl border border-white/10 bg-slate-900/60 p-6">
                    <div class="result-body h-full rounded-2xl border border-dashed border-white/10 bg-slate-950/40 px-4 py-6 text-center text-sm text-slate-400"
                         style="min-height: 120px;">
                        {{ ui['result_placeholder'] }}
                    </div>
                </div>
            </section>
        </main>
    </div>
</div>

<footer class="border-t border-white/10 bg-slate-950/80 py-6 text-sm text-slate-400">
    <div class="mx-auto flex w-full max-w-6xl flex-col gap-2 px-6 md:flex-row md:items-center md:justify-between md:px-12">
        <span>© {{ ui['title'] }}</span>
        <div>
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('auth.admin') }}" class="text-slate-400 transition hover:text-lime-300">Adminbereich</a>
            {% else %}
                <a href="{{ url_for('auth.login') }}" class="text-slate-400 transition hover:text-lime-300">Login</a>
            {% endif %}
        </div>
    </div>
</footer>

<script>
    window.APP_I18N = {
        lang: {{ current_language|tojson }},
        js: {{ js_strings|tojson }}
    };
</script>
<div id="toast_container" class="toast-container" aria-live="polite" aria-atomic="true"></div>
<script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
</body>
</html>
